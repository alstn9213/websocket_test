<!-- src/main/resources/static/index.html -->
<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>실시간 알림 테스트</title>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <style>-->
<!--        body { font-family: sans-serif; }-->
<!--        .container { padding: 10px; border: 1px solid #ccc; margin-bottom: 10px; }-->
<!--        #notification-list { list-style: none; padding: 0; }-->
<!--        #notification-list li { background-color: #f0f0f0; border: 1px solid #ddd; padding: 10px; margin-top: 5px; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; 1. 로그인 (사용자 이름 설정) &ndash;&gt;-->
<!--<div class="container">-->
<!--    <h3>1. 웹소켓 연결 (로그인)</h3>-->
<!--    <input type="text" id="username" placeholder="로그인할 이름을 입력 (예: alice)">-->
<!--    <button onclick="connect()">연결</button>-->
<!--    <div id="status" style="color: gray; margin-top: 5px;"></div>-->
<!--</div>-->

<!--&lt;!&ndash; 2. 알림 테스트 (HTTP API 호출) &ndash;&gt;-->
<!--<div class="container">-->
<!--    <h3>2. 알림 전송 테스트 (HTTP API 호출)</h3>-->
<!--    <input type="text" id="target-username" placeholder="알림 보낼 대상 (예: bob)">-->
<!--    <button onclick="sendNotification()">알림 전송 (API 호출)</button>-->
<!--    <div id="api-status" style="color: blue; margin-top: 5px;"></div>-->
<!--</div>-->

<!--&lt;!&ndash; 3. 수신된 알림 목록 &ndash;&gt;-->
<!--<div class="container">-->
<!--    <h3>3. 내가 받은 알림</h3>-->
<!--    <ul id="notification-list">-->
<!--        &lt;!&ndash; 알림이 여기에 표시됩니다 &ndash;&gt;-->
<!--    </ul>-->
<!--</div>-->

<!--<script>-->
<!--    'use strict';-->

<!--    let stompClient = null;-->
<!--    let myUsername = null;-->
<!--    const statusDiv = document.getElementById('status');-->
<!--    const notificationList = document.getElementById('notification-list');-->

<!--    // 1. WebSocket 연결 함수-->
<!--    function connect() {-->
<!--        myUsername = document.getElementById('username').value.trim();-->
<!--        if (!myUsername) {-->
<!--            alert('이름을 입력하세요.');-->
<!--            return;-->
<!--        }-->

<!--        // (1) (핵심) 연결 시 쿼리 파라미터로 username 전달-->
<!--        const socket = new SockJS('/ws?username=' + myUsername);-->
<!--        stompClient = Stomp.over(socket);-->

<!--        stompClient.connect({}, onConnected, onError);-->
<!--        statusDiv.textContent = myUsername + ' 님으로 연결 시도 중...';-->
<!--    }-->

<!--    // 2. 연결 성공 시 콜백-->
<!--    function onConnected() {-->
<!--        statusDiv.textContent = myUsername + ' 님, WebSocket 연결 성공!';-->

<!--        // (2) (핵심) '/user/queue/notifications' 구독-->
<!--        //    서버는 이 경로를 /user/{myUsername}/queue/notifications 로 인식-->
<!--        stompClient.subscribe('/user/queue/notifications', onNotificationReceived);-->
<!--    }-->

<!--    // 3. 연결 실패 시 콜백-->
<!--    function onError(error) {-->
<!--        statusDiv.textContent = '연결 실패. F12 콘솔을 확인하세요.';-->
<!--        console.error(error);-->
<!--    }-->

<!--    // 4. (서버->클라) 1:1 알림 수신-->
<!--    function onNotificationReceived(payload) {-->
<!--        const notification = JSON.parse(payload.body);-->

<!--        const li = document.createElement('li');-->
<!--        li.textContent = "[실시간 알림] " + notification.message;-->

<!--        // 새 알림을 목록 맨 위에 추가-->
<!--        notificationList.prepend(li);-->
<!--    }-->

<!--    // 5. (클라->서버) 알림 전송 API 호출 (이건 WebSocket이 아님!)-->
<!--    function sendNotification() {-->
<!--        const targetUsername = document.getElementById('target-username').value.trim();-->
<!--        if (!targetUsername) {-->
<!--            alert('알림 보낼 대상을 입력하세요.');-->
<!--            return;-->
<!--        }-->

<!--        const apiStatus = document.getElementById('api-status');-->
<!--        apiStatus.textContent = targetUsername + '에게 알림 전송 시도...';-->

<!--        // (3) (핵심) NotificationController에서 만든 HTTP API 호출-->
<!--        fetch('/api/send-notification/' + targetUsername, {-->
<!--            method: 'GET'-->
<!--        })-->
<!--        .then(response => response.text())-->
<!--        .then(result => {-->
<!--            apiStatus.textContent = "API 응답: " + result;-->
<!--        })-->
<!--        .catch(error => {-->
<!--            apiStatus.textContent = "API 호출 실패.";-->
<!--            console.error('Error:', error);-->
<!--        });-->
<!--    }-->

<!--</script>-->

<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>실시간 공동 문서 편집기</title>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <style>-->
<!--        body { font-family: sans-serif; }-->
<!--        #editor {-->
<!--            width: 100%;-->
<!--            height: 500px;-->
<!--            font-size: 16px;-->
<!--            border: 1px solid #ccc;-->
<!--        }-->
<!--        #status { font-style: italic; color: green; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<h1>실시간 공동 문서 편집기 (Demo)</h1>-->
<!--<div id="status">연결 중...</div>-->
<!--<textarea id="editor" placeholder="여기에 타이핑하세요..."></textarea>-->

<!--<script>-->
<!--    'use strict';-->

<!--    const editor = document.getElementById('editor');-->
<!--    const statusDiv = document.getElementById('status');-->

<!--    let stompClient = null;-->
<!--    let mySessionId = null; // 자신이 보낸 메시지인지 확인하기 위함-->

<!--    // 1. WebSocket 연결-->
<!--    function connect() {-->
<!--        const socket = new SockJS('/ws');-->
<!--        stompClient = Stomp.over(socket);-->

<!--        stompClient.connect({}, onConnected, onError);-->
<!--    }-->

<!--    // 2. 연결 성공 시 콜백-->
<!--    function onConnected(frame) {-->
<!--        statusDiv.textContent = "연결 성공!";-->

<!--        // (중요) 연결 성공 시 자신의 세션 ID 저장-->
<!--        // STOMP는 /user/queue/document 구독 시, 실제로는 /user/{sessionId}/queue/document로 변환해줍니다.-->
<!--        // 이 sessionId를 URL에서 파싱하여 가져옵니다. (약간의 트릭)-->
<!--        const transportUrl = stompClient.ws._transport.url;-->
<!--        mySessionId = transportUrl.match(/[\w-]+\/[\w-]+\/([\w-]+)\//)[1];-->
<!--        console.log("My Session ID: " + mySessionId);-->


<!--        // (1) /topic/document 구독 (다른 사람의 변경 사항 수신)-->
<!--        stompClient.subscribe('/topic/document', onDocumentUpdate);-->

<!--        // (2) /user/queue/document 구독 (최초 접속 시 현재 문서 상태 수신)-->
<!--        stompClient.subscribe('/user/queue/document', onDocumentUpdate);-->

<!--        // (3) (중요) 서버에 현재 문서 상태를 요청-->
<!--        // -> /app/document.requestCurrent 로 메시지 전송-->
<!--        stompClient.send("/app/document.requestCurrent", {}, "{}");-->
<!--    }-->

<!--    // 3. 연결 실패 시 콜백-->
<!--    function onError(error) {-->
<!--        statusDiv.textContent = "연결 실패. F12 콘솔을 확인하세요.";-->
<!--        console.error(error);-->
<!--    }-->

<!--    // 4. (서버->클라) 서버로부터 문서 업데이트 수신-->
<!--    function onDocumentUpdate(payload) {-->
<!--        const documentState = JSON.parse(payload.body);-->

<!--        // (중요) 내가 보낸 변경 사항이 브로드캐스트된 것이라면 무시-->
<!--        // (무시하지 않으면, 내 커서가 맨 앞으로 이동하는 현상 발생)-->
<!--        if (documentState.editorId === mySessionId) {-->
<!--            console.log("Ignoring my own update");-->
<!--            return;-->
<!--        }-->

<!--        // 텍스트 에어리어의 내용을 서버가 보내준 내용으로 업데이트-->
<!--        // (커서 위치 유지를 위해 현재 커서 위치 저장)-->
<!--        const currentCursor = editor.selectionStart;-->
<!--        editor.value = documentState.content;-->

<!--        // (참고) 다른 사람이 수정하면 커서 위치가 꼬일 수 있으나,-->
<!--        // 간단한 예제이므로 커서 위치 동기화는 생략합니다.-->
<!--        // editor.selectionStart = editor.selectionEnd = currentCursor;-->
<!--    }-->

<!--    // 5. (클라->서버) 사용자가 텍스트 에어리어에 타이핑할 때-->
<!--    editor.oninput = function() {-->
<!--        if (!stompClient) return;-->

<!--        const content = editor.value;-->

<!--        // 서버의 /app/document.update 로 현재 문서 내용 전송-->
<!--        stompClient.send("/app/document.update",-->
<!--            {},-->
<!--            JSON.stringify({ 'content': content })-->
<!--        );-->
<!--    };-->

<!--    // -&#45;&#45; 페이지 로드 시 바로 연결 -&#45;&#45;-->
<!--    connect();-->

<!--</script>-->

<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title charset="UTF-8">간단 채팅방</title>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <style>-->
<!--        body { font-family: sans-serif; }-->
<!--        #chat-window { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }-->
<!--        .message { margin-bottom: 5px; }-->
<!--        .event-message { color: gray; font-style: italic; }-->
<!--        #username-page, #chat-page { padding: 10px; }-->
<!--        #chat-page { display: none; } /* 처음에는 숨김 */-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<div id="username-page">-->
<!--    <h3>채팅방 입장</h3>-->
<!--    <input type="text" id="username" placeholder="이름을 입력하세요">-->
<!--    <button onclick="connect()">입장</button>-->
<!--</div>-->

<!--<div id="chat-page">-->
<!--    <h3>WebSocket 채팅방</h3>-->
<!--    <div id="chat-window">-->
<!--    </div>-->
<!--    <input type="text" id="message" placeholder="메시지 입력...">-->
<!--    <button onclick="sendMessage()">전송</button>-->
<!--</div>-->

<!--<script>-->
<!--    'use strict';-->

<!--    let stompClient = null;-->
<!--    let username = null;-->

<!--    const usernamePage = document.getElementById('username-page');-->
<!--    const chatPage = document.getElementById('chat-page');-->
<!--    const chatWindow = document.getElementById('chat-window');-->

<!--    // 1. WebSocket 연결 함수-->
<!--    function connect() {-->
<!--        username = document.getElementById('username').value.trim();-->

<!--        if (username) {-->
<!--            // 이름 입력 시 채팅방 화면으로 전환-->
<!--            usernamePage.style.display = 'none';-->
<!--            chatPage.style.display = 'block';-->

<!--            // Spring Boot 서버의 /ws 엔드포인트에 연결-->
<!--            const socket = new SockJS('/ws');-->
<!--            stompClient = Stomp.over(socket);-->

<!--            stompClient.connect({}, onConnected, onError);-->
<!--        }-->
<!--    }-->

<!--    // 2. 연결 성공 시 콜백-->
<!--    function onConnected() {-->
<!--        // (1) /topic/public 채널 구독-->
<!--        stompClient.subscribe('/topic/public', onMessageReceived);-->

<!--        // (2) 서버의 /app/chat.addUser 로 "JOIN" 메시지 전송-->
<!--        stompClient.send("/app/chat.addUser",-->
<!--            {},-->
<!--            JSON.stringify({sender: username, type: 'JOIN'})-->
<!--        );-->
<!--        logEventMessage(username + ' 님이 입장하셨습니다.');-->
<!--    }-->

<!--    // 3. 연결 실패 시 콜백-->
<!--    function onError(error) {-->
<!--        logEventMessage('연결에 실패했습니다. F12를 눌러 콘솔을 확인하세요.');-->
<!--    }-->

<!--    // 4. 메시지 전송 함수-->
<!--    function sendMessage() {-->
<!--        const messageInput = document.getElementById('message');-->
<!--        const messageContent = messageInput.value.trim();-->

<!--        if (messageContent && stompClient) {-->
<!--            const chatMessage = {-->
<!--                sender: username,-->
<!--                content: messageContent,-->
<!--                type: 'CHAT'-->
<!--            };-->

<!--            // (3) 서버의 /app/chat.sendMessage 로 "CHAT" 메시지 전송-->
<!--            stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));-->
<!--            messageInput.value = ''; // 입력창 비우기-->
<!--        }-->
<!--    }-->

<!--    // 5. 서버로부터 메시지 수신 시 콜백-->
<!--    function onMessageReceived(payload) {-->
<!--        const message = JSON.parse(payload.body);-->

<!--        if (message.type === 'JOIN') {-->
<!--            logEventMessage(message.sender + ' 님이 입장하셨습니다.');-->
<!--        } else if (message.type === 'LEAVE') {-->
<!--            logEventMessage(message.sender + ' 님이 퇴장하셨습니다.');-->
<!--        } else { // CHAT-->
<!--            logChatMessage(message.sender, message.content);-->
<!--        }-->
<!--    }-->

<!--    // -&#45;&#45; Helper Functions -&#45;&#45;-->
<!--    function logChatMessage(sender, content) {-->
<!--        const messageElement = document.createElement('div');-->
<!--        messageElement.classList.add('message');-->
<!--        messageElement.innerHTML = '<b>' + sender + ':</b> ' + content;-->
<!--        chatWindow.appendChild(messageElement);-->
<!--        chatWindow.scrollTop = chatWindow.scrollHeight;-->
<!--    }-->
<!--    function logEventMessage(message) {-->
<!--        const messageElement = document.createElement('div');-->
<!--        messageElement.classList.add('message', 'event-message');-->
<!--        messageElement.textContent = message;-->
<!--        chatWindow.appendChild(messageElement);-->
<!--        chatWindow.scrollTop = chatWindow.scrollHeight;-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->